---
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

export async function getStaticPaths() {
  const posts = await getCollection('blog');
  return posts.map((post: CollectionEntry<'blog'>) => ({
    params: { slug: post.slug },
    props: post,
  }));
}

type Props = CollectionEntry<'blog'>;
const post = Astro.props;
const { Content, headings } = await post.render();
---

<Layout title={`${post.data.title} — Chen Yang`} description={post.data.description}>
  <!-- Reading Progress Bar -->
  <div id="progress-bar" class="fixed top-0 left-0 h-1 bg-blue-600 z-50 transition-all duration-150" style="width: 0%"></div>

  <article class="py-12 md:py-20 reveal">
    <div class="mx-auto max-w-3xl px-6">
      <!-- Article Header -->
      <header class="mb-16 text-center">
        <div class="flex items-center justify-center gap-3 mb-8">
          <span class="px-4 py-1 rounded-full text-xs font-bold bg-blue-50 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400 uppercase tracking-widest border border-blue-100 dark:border-blue-800/50">
            {post.data.category}
          </span>
          <span class="text-sm text-slate-400 dark:text-slate-500 font-medium flex items-center gap-1.5">
            <i data-lucide="calendar" class="w-4 h-4"></i>
            {post.data.pubDate.toLocaleDateString('zh-CN', { year: 'numeric', month: 'long', day: 'numeric' })}
          </span>
          {post.data.readingTime && (
            <span class="text-sm text-slate-400 dark:text-slate-500 font-medium flex items-center gap-1.5 border-l border-slate-200 dark:border-slate-800 pl-3">
              <i data-lucide="clock" class="w-4 h-4"></i> {post.data.readingTime}
            </span>
          )}
        </div>

        <h1 class="text-4xl md:text-5xl lg:text-6xl font-extrabold text-gray-900 dark:text-white leading-[1.15] mb-12 tracking-tight">
          {post.data.title}
        </h1>
      </header>

      <!-- Content -->
      <div
        class="prose prose-lg dark:prose-invert max-w-none text-gray-800 dark:text-slate-200 leading-[2] font-mingliu
          prose-headings:font-bold prose-headings:tracking-tight prose-headings:text-gray-900 dark:prose-headings:text-white
          prose-h2:text-3xl prose-h2:mt-16 prose-h2:mb-8 prose-h2:pb-2 prose-h2:border-b prose-h2:border-slate-100 dark:prose-h2:border-slate-800
          prose-h3:text-2xl prose-h3:mt-12 prose-h3:mb-6
          prose-p:mb-10 prose-p:text-justify prose-p:leading-[2] prose-p:indent-[2em]
          prose-a:text-blue-600 dark:prose-a:text-blue-400 prose-a:no-underline hover:prose-a:underline
          prose-blockquote:border-l-4 prose-blockquote:border-blue-500 prose-blockquote:bg-slate-50 dark:prose-blockquote:bg-slate-900/40 prose-blockquote:py-4 prose-blockquote:px-8 prose-blockquote:my-10 prose-blockquote:rounded-r-2xl prose-blockquote:not-italic prose-blockquote:text-slate-600 dark:prose-blockquote:text-slate-400 prose-blockquote:indent-0
          prose-hr:border-slate-100 dark:prose-hr:border-slate-800 prose-hr:my-16
          prose-img:rounded-3xl prose-img:shadow-2xl"
      >
        <Content />
      </div>

      <!-- Footer Navigation -->
      <footer class="mt-24 pt-12 border-t border-slate-100 dark:border-slate-800/50">
        <div class="flex flex-col md:flex-row justify-between items-center gap-8">
          <a href="/blog" class="inline-flex items-center gap-2 px-6 py-3 rounded-2xl bg-slate-50 dark:bg-slate-900 text-blue-600 dark:text-blue-400 font-bold hover:bg-blue-600 hover:text-white transition-all duration-300 shadow-sm">
            <i data-lucide="arrow-left" class="w-5 h-5"></i> Back to Blog
          </a>
          
          <div class="flex gap-3">
            <button onclick="navigator.clipboard.writeText(window.location.href); alert('Link copied!')" class="flex items-center gap-2 px-6 py-3 rounded-2xl border border-slate-200 dark:border-slate-800 text-slate-500 hover:bg-slate-50 dark:hover:bg-slate-900 transition-all duration-300 shadow-sm" title="Copy Link">
              <i data-lucide="share-2" class="w-5 h-5"></i>
              <span class="text-sm font-medium">Share</span>
            </button>
          </div>
        </div>

        <div class="mt-16 p-8 rounded-3xl bg-slate-50 dark:bg-slate-900/50 border border-slate-100 dark:border-slate-800/50 text-center">
          <p class="text-slate-500 dark:text-slate-400 text-sm mb-4">
            感谢阅读我的文章。如果您有任何想法或建议，欢迎联系我。
          </p>
          <div class="flex justify-center gap-6">
            <a href="mailto:yangchen73@link.cuhk.edu.cn" class="text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
              <i data-lucide="mail" class="w-6 h-6"></i>
            </a>
            <a href="https://github.com/yangchen73" class="text-slate-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors">
              <i data-lucide="github" class="w-6 h-6"></i>
            </a>
          </div>
        </div>
      </footer>
    </div>
  </article>

  <script>
    // Progress Bar Logic
    window.addEventListener('scroll', () => {
      const winScroll = document.body.scrollTop || document.documentElement.scrollTop;
      const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
      const scrolled = (winScroll / height) * 100;
      const progressBar = document.getElementById('progress-bar') as HTMLElement;
      if (progressBar) {
        progressBar.style.width = scrolled + '%';
      }
    });
  </script>
</Layout>


